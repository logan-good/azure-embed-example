<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADX Dashboard Embedding Example</title>
    <script type="module">
        // Assume you are using @azure/msal-react to get the access token
        import { useMsal } from "@azure/msal-react";

        window.addEventListener('message', (event) => {
            if (event.data.signature === "queryExplorer" && event.data.type === "getToken") {
                const { instance, accounts } = useMsal();
                instance.acquireTokenSilent({
                    scopes: mapScope(event.data.scope),
                    account: accounts[0],
                })
                .then((response) => {
                    var accessToken = response.accessToken;
                    // Replace the following placeholder with code to post a "postToken" message with an access token and an event.data.scope
                    postToken(accessToken, event.data.scope);
                })
            }
        });

        function mapScope(scope) {
            switch(scope) {
                case "query": return ["https://your_cluster.your_region.kusto.windows.net/.default"];
                case "People.Read": return ["People.Read", "User.ReadBasic.All", "Group.Read.All"];
                default: return [scope];
            }
        }

        function postToken(accessToken, scope) {
            const iframeWindow = document.querySelector('iframe').contentWindow;
            iframeWindow.postMessage({
                "type": "postToken",
                "message": accessToken,  // the access token you obtained earlier
                "scope": scope  // event.data.scope as passed to the "getToken" message
            }, '*');
        }
    </script>
</head>
<body>

<iframe
    src="https://dataexplorer.azure.com/?f-IFrameAuth=true&f-UseMeControl=false&workspace=<guid>"
    style="width:100%; height:100vh;"  <!-- Adjust width and height to fit your design -->
></iframe>

</body>
</html>
